- apiVersion: v1
  kind: Pod
  metadata:
    annotations:
      openshift.io/scc: restricted-v2
      seccomp.security.alpha.kubernetes.io/pod: runtime/default
    creationTimestamp: "2023-12-18T08:30:22Z"
    generateName: mistral-7b-84ffcbb8df-
    labels:
      app: mistral-7b
      pod-template-hash: 84ffcbb8df
    name: mistral-7b-84ffcbb8df-qj7g5
    namespace: ai
    ownerReferences:
      - apiVersion: apps/v1
        blockOwnerDeletion: true
        controller: true
        kind: ReplicaSet
        name: mistral-7b-84ffcbb8df
        uid: b5eaeadf-d279-434b-8f8e-502aa2173109
    resourceVersion: "2431841095"
    uid: e5ebfea8-0120-4380-ad57-588696c7fae8
  spec:
    affinity: {}
    containers:
      - env:
          - name: QUANTIZE
            value: bitsandbytes
          - name: HUGGINGFACE_HUB_CACHE
            value: /models-cache
          - name: PORT
            value: "3000"
          - name: HOST
            value: 0.0.0.0
        image: ghcr.io/huggingface/text-generation-inference:sha-b226e46
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /health
            port: http
            scheme: HTTP
          periodSeconds: 100
          successThreshold: 1
          timeoutSeconds: 8
        name: server
        ports:
          - containerPort: 3000
            name: http
            protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /health
            port: http
            scheme: HTTP
          periodSeconds: 30
          successThreshold: 1
          timeoutSeconds: 5
        resources:
          limits:
            cpu: "8"
            memory: 24Gi
            nvidia.com/gpu: "1"
          requests:
            cpu: "6"
            memory: 24Gi
            nvidia.com/gpu: "1"
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
              - ALL
          runAsNonRoot: true
          runAsUser: 1001630000
          seccompProfile:
            type: RuntimeDefault
        startupProbe:
          failureThreshold: 24
          httpGet:
            path: /health
            port: http
            scheme: HTTP
          periodSeconds: 30
          successThreshold: 1
          timeoutSeconds: 1
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
          - mountPath: /models-cache
            name: models-cache-mistral-7b
          - mountPath: /dev/shm
            name: shm
          - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
            name: kube-api-access-cnpbk
            readOnly: true
      - env:
          - name: QUANTIZE
            value: bitsandbytes
          - name: HUGGINGFACE_HUB_CACHE
            value: /models-cache
          - name: PORT
            value: "3000"
          - name: HOST
            value: 0.0.0.0
        image: ghcr.io/huggingface/text-generation-inference:sha-b226e46
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /health
            port: http
            scheme: HTTP
          periodSeconds: 100
          successThreshold: 1
          timeoutSeconds: 8
        name: limitless
        ports:
          - containerPort: 3000
            name: http
            protocol: TCP
        resources:
          limits:
            cpu: "8"
            memory: 24Gi
            nvidia.com/gpu: "1"
          requests:
            cpu: "6"
            memory: 24Gi
            nvidia.com/gpu: "1"
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
              - ALL
          runAsNonRoot: true
          runAsUser: 1001630000
          seccompProfile:
            type: RuntimeDefault
        startupProbe:
          failureThreshold: 24
          httpGet:
            path: /health
            port: http
            scheme: HTTP
          periodSeconds: 30
          successThreshold: 1
          timeoutSeconds: 1
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
          - mountPath: /models-cache
            name: models-cache-mistral-7b
          - mountPath: /dev/shm
            name: shm
          - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
            name: kube-api-access-cnpbk
            readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    imagePullSecrets:
      - name: default-dockercfg-6xs69
    nodeName: occ01bm04.infra.cc.corp
    nodeSelector:
      node-role.kubernetes.io/app: ""
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: Always
    schedulerName: default-scheduler
    securityContext:
      fsGroup: 1001630000
      seLinuxOptions:
        level: s0:c40,c35
      seccompProfile:
        type: RuntimeDefault
    serviceAccount: default
    serviceAccountName: default
    terminationGracePeriodSeconds: 120
    tolerations:
      - effect: NoSchedule
        key: nvidia.com/gpu
        operator: Exists
      - effect: NoExecute
        key: node.kubernetes.io/not-ready
        operator: Exists
        tolerationSeconds: 300
      - effect: NoExecute
        key: node.kubernetes.io/unreachable
        operator: Exists
        tolerationSeconds: 300
      - effect: NoSchedule
        key: node.kubernetes.io/memory-pressure
        operator: Exists
    volumes:
      - name: models-cache-mistral-7b
        persistentVolumeClaim:
          claimName: models-cache-mistral-7b
      - emptyDir:
          medium: Memory
          sizeLimit: 1Gi
        name: shm
      - name: kube-api-access-cnpbk
        projected:
          defaultMode: 420
          sources:
            - serviceAccountToken:
                expirationSeconds: 3607
                path: token
            - configMap:
                items:
                  - key: ca.crt
                    path: ca.crt
                name: kube-root-ca.crt
            - downwardAPI:
                items:
                  - fieldRef:
                      apiVersion: v1
                      fieldPath: metadata.namespace
                    path: namespace
            - configMap:
                items:
                  - key: service-ca.crt
                    path: service-ca.crt
                name: openshift-service-ca.crt
